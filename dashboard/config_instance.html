<?php

/**
 * Dashboard instance setup form
 * 
 * @package block-dashboard
 * @category blocks
 * @author Valery Fremaux (valery@club-internet.fr)
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL
 * @version Moodle 1.9
 */

global $COURSE;

if (!isset($this->config->target)) $this->config->target = 'moodle';
if (!isset($this->config->hidetitle)) $this->config->hidetitle = 0;
if (!isset($this->config->showdata)) $this->config->showdata = 1;
if (!isset($this->config->showgraph)) $this->config->showgraph = 1;
if (!isset($this->config->shownumsums)) $this->config->shownumsums = 1;
if (!isset($this->config->showquery)) $this->config->showquery = 0;
if (!isset($this->config->showfilterqueries)) $this->config->showfilterqueries = 0;
if (!isset($this->config->inblocklayout)) $this->config->inblocklayout = ($COURSE->format == 'page') ? 1 :  0 ;

?>
<script src="<?php echo $CFG->wwwroot ?>/blocks/dashboard/js/js.js" type="text/javascript"></script>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
    <td align="right" style="line-height:1.5em" >
        <b><?php print_string('configtitle', 'block_dashboard'); ?>:</b><br/>
        <b><?php print_string('confighidetitle', 'block_dashboard'); ?>:</b>
    </td>
    <td>
        <?php 
            $thistitle = '';
            if (isset($this->config) && isset($this->config->title)) {
                $thistitle = $this->config->title;
            }
            echo '<input type="text" name="title" size="60" value="'.$thistitle.'" />';
            $hidetitle = '';
            if (isset($this->config) && isset($this->config->hidetitle)) {
                $hidetitle = ($this->config->hidetitle) ? ' checked="checked" ' : '' ;
            }
            echo '<br/><input type="checkbox" name="hidetitle" '.$hidetitle.' /> '.get_string('checktohide', 'block_dashboard');
        ?>
    </td>
</tr>
</table>

<fieldset>
<legend><?php print_string('dashboardlayout', 'block_dashboard') ?></legend>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
    <td align="right" style="line-height:1.5em" >
        <b><?php print_string('configlayout', 'block_dashboard'); ?>:</b>
    </td>
    <td>
    	<?php choose_from_menu_yesno('inblocklayout', $this->config->inblocklayout, '') ?>
    </td>
</tr>
</table>
</fieldset>

<fieldset>
<legend><?php print_string('queryparams', 'block_dashboard') ?></legend>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
    <td align="right">
        <b><?php print_string('configtarget', 'block_dashboard'); ?>:</b>
    </td>
    <td>
    	<?php
    	$targets = array('moodle' => 'Moodle', 'extra' => 'Extra DB');
    	choose_from_menu($targets, 'target', $this->config->target);
    	?>
    </td>
    <td align="right">
        <b><?php print_string('configdisplay', 'block_dashboard'); ?>:</b>
    </td>
    <td>
	    <?php print_string('configshowdata', 'block_dashboard'); ?>
	    <input type="radio" name="showdata" value="1" <?php echo ($this->config->showdata) ? 'checked="checked"' : '' ?> />
	    <?php print_string('yes'); ?>
	    <input type="radio" name="showdata" value="0" <?php echo (!$this->config->showdata) ? 'checked="checked"' : '' ?> />
	    <?php print_string('no'); ?>
	    <?php echo '<br/>' ?>

	    <?php print_string('configshowgraph', 'block_dashboard'); ?>
	    <input type="radio" name="showgraph" value="1" <?php echo ($this->config->showgraph) ? 'checked="checked"' : '' ?> />
	    <?php print_string('yes'); ?>
	    <input type="radio" name="showgraph" value="0" <?php echo (!$this->config->showgraph) ? 'checked="checked"' : '' ?> />
	    <?php print_string('no'); ?>
	    <?php echo '<br/>' ?>

	    <?php print_string('configshownumsums', 'block_dashboard'); ?>
	    <input type="radio" name="shownumsums" value="1" <?php echo ($this->config->shownumsums) ? 'checked="checked"' : '' ?> />
	    <?php print_string('yes'); ?>
	    <input type="radio" name="shownumsums" value="0" <?php echo (!$this->config->shownumsums) ? 'checked="checked"' : '' ?> />
	    <?php print_string('no'); ?>
	    <?php echo '<br/>' ?>

	    <?php print_string('configshowquery', 'block_dashboard'); ?>
	    <input type="radio" name="showquery" value="1" <?php echo ($this->config->showquery) ? 'checked="checked"' : '' ?> />
	    <?php print_string('yes'); ?>
	    <input type="radio" name="showquery" value="0" <?php echo (!$this->config->showquery) ? 'checked="checked"' : '' ?> />
	    <?php print_string('no'); ?>
	    <?php echo '<br/>' ?>
	    <?php print_string('configshowfilterqueries', 'block_dashboard'); ?>
	    <input type="radio" name="showfilterqueries" value="1" <?php echo ($this->config->showfilterqueries) ? 'checked="checked"' : '' ?> />
	    <?php print_string('yes'); ?>
	    <input type="radio" name="showfilterqueries" value="0" <?php echo (!$this->config->showfilterqueries) ? 'checked="checked"' : '' ?> />
	    <?php print_string('no'); ?>
	    <?php echo '<br/>' ?>
    </td>
</tr>
<tr valign="top">
    <td align="right">
        <b><?php print_string('configquery', 'block_dashboard'); ?>: <?php helpbutton('query', get_string('configquery', 'block_dashboard'), 'block_dashboard') ?></b>
    </td>
    <td align="center" colspan="3">
        <?php 
            $thistitle = '';
            if (isset($this->config) && isset($this->config->query)) {
                $thistitle = $this->config->query;
            }
            echo '<textarea name="query" cols="80" rows="10" >'.$thistitle.'</textarea>';
        ?>
    </td>
</tr>
</table>
</fieldset>

<fieldset>
<legend><?php print_string('outputparams', 'block_dashboard') ?></legend>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
    <td align="center" colspan="4">
        <?php print_string('configreminderonsep', 'block_dashboard'); ?>
    </td>
</tr>
<tr valign="top">
    <td align="right" width="50%" style="line-height:1.5em;font-size:0.85em" colspan="2">
    	<table width="100%">
    		<tr valign="top">
        		<td width="50%" align="right"><b><?php print_string('configoutputfields', 'block_dashboard'); ?>: <?php helpbutton('output', get_string('configoutputfields', 'block_dashboard'), 'block_dashboard') ?></b> </td>
		    	<td width="50%" align="left">
		        <?php 
		            $fields = '';
		            if (isset($this->config) && isset($this->config->outputfields)) {
		                $fields = $this->config->outputfields;
		            }
		            echo '<input type="text" name="outputfields" size="30" value="'.$fields.'" />';
		        ?>
		      	</td>
        	</tr>
    		<tr>
        		<td align="right"><b><?php print_string('configoutputformats', 'block_dashboard'); ?>: <?php helpbutton('formatting', get_string('configoutputformats', 'block_dashboard'), 'block_dashboard') ?></b> </td>
		      	<td align="left">
		        <?php 
		            $formats = '';
		            if (isset($this->config) && isset($this->config->outputformats)) {
		                $formats = htmlentities($this->config->outputformats, ENT_QUOTES, 'UTF-8');
		            }
		            echo '<input type="text" name="outputformats" size="30" value="'.$formats.'" />';
		        ?>
		      	</td>
        	</tr>
    		<tr>
        		<td align="right"><b><?php print_string('configpagesize', 'block_dashboard'); ?>: <?php helpbutton('pagesize', get_string('configpagesize', 'block_dashboard'), 'block_dashboard') ?></b></td>
			    <td align="left">
		        <?php 
		            $pagesize = '';
		            if (isset($this->config) && isset($this->config->pagesize)) {
		                $pagesize = $this->config->pagesize;
		            }
		            $bigresult = '';
		            if (isset($this->config) && isset($this->config->bigresult)) {
		                $bigresult = 'checked="checked"';
		            }
		            
		            echo '<input type="text" name="pagesize" size="10" value="'.$pagesize.'" /> <input type="checkbox" name="bigresult" value="1" '.$bigresult.' />'.get_string('bigresult', 'block_dashboard').' ';
		            helpbutton('bigresult', get_string('bigresult', 'block_dashboard'), 'block_dashboard');
				?>
				</td>
        	</tr>
    		<tr>
        		<td align="right"><b><?php print_string('configcaching', 'block_dashboard'); ?>: <?php helpbutton('caching', get_string('configcaching', 'block_dashboard'), 'block_dashboard') ?></b></td>
			    <td align="left">
			    <?php
		            $uselocalcachingyeschecked = '';
		            $uselocalcachingnochecked = ' checked=\"checked\" ';
		            if (isset($this->config) && isset($this->config->uselocalcaching)) {
		                $uselocalcachingyeschecked = ($this->config->uselocalcaching) ? ' checked=\"checked\" ' : '' ;
		                $uselocalcachingnochecked = ($this->config->uselocalcaching) ? ' checked=\"checked\" ' : '' ;
		            }
		            echo "<input type=\"radio\" name=\"uselocalcaching\" value=\"0\" $uselocalcachingnochecked /> ".get_string('no')." - <input type=\"radio\" name=\"uselocalcaching\" value=\"1\" $uselocalcachingyeschecked /> ".get_string('yes');
			     ?>
			     </td>
        	</tr>
    		<tr>
        		<td align="right"><b><?php print_string('configcachingttl', 'block_dashboard'); ?>:</b></td>
			    <td align="left">
			    <?php
		            $cachingttl = '';
		            if (isset($this->config) && isset($this->config->cachingttl)) {
		                $cachingttl = $this->config->cachingttl;
		            }
		            echo '<input type="text" name="cachingttl" size="10" value="'.$cachingttl.'" /> '.get_string('minutes');
			    ?>
			    </td>
        	</tr>
    		<tr>
        		<td align="right"><b><?php print_string('configcleandisplay', 'block_dashboard'); ?>:</b></td>
				<td align="left">
				<?php
		            $cleandisplayyes = 'checked="checked"';
		            $cleandisplayno = '';
		            if (isset($this->config) && isset($this->config->cleandisplay)) {
		            	if ($this->config->cleandisplay){
			                $cleandisplayyes = 'checked="checked"';
			                $cleandisplayno = '';
			            } else {
			                $cleandisplayyes = '';
			                $cleandisplayno = 'checked="checked"';
			            }
		            }
		            echo "<input type=\"radio\" name=\"cleandisplay\" value=\"1\" $cleandisplayyes /> ".get_string('yes'). " <input type=\"radio\" name=\"cleandisplay\" value=\"0\" $cleandisplayno /> ".get_string('no');			            
			    ?>
			    </td>
        	</tr>
    		<tr>
        		<td align="right"><b><?php print_string('configsortable', 'block_dashboard'); ?>:</b></td>
				<td align="left">
				<?php
		            $sortableyes = 'checked="checked"';
		            $sortableno = '';
		            if (isset($this->config) && isset($this->config->sortable)) {
		            	if ($this->config->sortable){
			                $sortableyes = 'checked="checked"';
			                $sortableno = '';
			            } else {
			                $sortableyes = '';
			                $sortableno = 'checked="checked"';
			            }
		            }
		            echo "<input type=\"radio\" name=\"sortable\" value=\"1\" $sortableyes /> ".get_string('yes'). " <input type=\"radio\" name=\"sortable\" value=\"0\" $sortableno /> ".get_string('no');			            
			    ?>
			    </td>
        	</tr>
    		<tr>
        		<td align="right"><b><?php print_string('configsplitsumsonsort', 'block_dashboard'); ?>: <?php helpbutton('splitsumsonsort', get_string('configsplitsumsonsort', 'block_dashboard'), 'block_dashboard') ?></b></td>
				<td align="left">
					<?php
		            $splitsumsonsort = '';
		            if (isset($this->config) && isset($this->config->splitsumsonsort)) {
		                $splitsumsonsort = $this->config->splitsumsonsort;
		            }
		            echo "<input type=\"text\" name=\"splitsumsonsort\" value=\"$splitsumsonsort\" />";
		            ?>
			    </td>
        	</tr>
        </table>
    </td>
    <td align="right" style="font-size:0.9em" colspan="2">
    	<table width="100%">
    		<tr valign="top">
    			<td width="50%" align="right"><b><?php print_string('configoutputfieldslabels', 'block_dashboard'); ?>:</b></td>
    			<td width="50%" align="left">
		        <?php 
		            $fieldlabels = '';
		            if (isset($this->config) && isset($this->config->fieldlabels)) {
		                $fieldlabels = $this->config->fieldlabels;
		            }
		            echo '<textarea name="fieldlabels" cols="30" rows="5" >'.$fieldlabels.'</textarea>';
		        ?>
    			</td>
    		</tr>
    	</table>
    </td>
</tr>
<tr valign="top">
    <td align="right" style="line-height:1.5em">
        <b><?php print_string('configfilters', 'block_dashboard'); ?>: <?php helpbutton('filters', get_string('configfilters', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configfilterdefaults', 'block_dashboard'); ?>: <?php helpbutton('filterdefaults', get_string('configfilterdefaults', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configfilteroptions', 'block_dashboard'); ?>: <?php helpbutton('filteroptions', get_string('configfilteroptions', 'block_dashboard'), 'block_dashboard') ?></b>
    </td>
    <td style="line-height:1.5em">
        <?php 
            $filters = '';
            if (isset($this->config) && isset($this->config->filters)) {
                $filters = $this->config->filters;
            }
            echo '<input type="text" name="filters" size="30" value="'.$filters.'" />';
            $filterdefaults = '';
            if (isset($this->config) && isset($this->config->filterdefaults)) {
                $filterdefaults = $this->config->filterdefaults;
            }
            echo '<br/><input type="text" name="filterdefaults" size="30" value="'.$filterdefaults.'" />';
            $filteroptions = '';
            if (isset($this->config) && isset($this->config->filteroptions)) {
                $filteroptions = $this->config->filteroptions;
            }
            echo '<br/><input type="text" name="filteroptions" size="30" value="'.$filteroptions.'" />';
        ?>
    </td>
    <td align="right">
        <b><?php print_string('configfilterlabels', 'block_dashboard'); ?>:</b>
    </td>
    <td>
        <?php 
            $filterlabels = '';
            if (isset($this->config) && isset($this->config->filterlabels)) {
                $filterlabels = $this->config->filterlabels;
            }
            echo '<textarea name="filterlabels" cols="30" rows="5" >'.$filterlabels.'</textarea>';
        ?>
    </td>
</tr>
<tr valign="top">
    <td align="right" style="line-height:1.5em">
        <b><?php print_string('configtabletype', 'block_dashboard'); ?>: <?php helpbutton('tabletype', get_string('configtabletype', 'block_dashboard'), 'block_dashboard') ?></b>
    </td>
    <td style="line-height:1.5em">
        <?php 
            $tabletype = '';
            if (isset($this->config) && isset($this->config->tabletype)) {
                $tabletype = $this->config->tabletype;
            }
            
            $tabletypeopts['linear'] = get_string('linear', 'block_dashboard');
            $tabletypeopts['tabular'] = get_string('tabular', 'block_dashboard');
            $tabletypeopts['treeview'] = get_string('treeview', 'block_dashboard');
            
            choose_from_menu($tabletypeopts, 'tabletype', $tabletype, '', 'showmoreoptions(this)');
        ?>
    </td>
    <td align="right">
    </td>
    <td>
    </td>
</tr>
</table>
</fieldset>

<?php 
$tabularstyle = (!empty($this->config->tabletype) && $this->config->tabletype == 'tabular') ? 'visibility:visible;display:block' : 'visibility:hidden;display:none' ;
?>
<div id="tabularparams" style="<?php echo $tabularstyle ?>">
<fieldset>
<legend><?php print_string('tabularparams', 'block_dashboard') ?></legend>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
	<td>
        <b><?php print_string('configverticalkeys', 'block_dashboard'); ?>: <?php helpbutton('tabular', get_string('configverticalkeys', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('confighorizkey', 'block_dashboard'); ?>: <?php helpbutton('tabular', get_string('confighorizkey', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configverticalformats', 'block_dashboard'); ?>: <?php helpbutton('formatting', get_string('configverticalformats', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('confighorizformat', 'block_dashboard'); ?>: <?php helpbutton('formatting', get_string('confighorizformat', 'block_dashboard'), 'block_dashboard') ?></b><br/><br/>
        <b><?php print_string('configspliton', 'block_dashboard'); ?>: <?php helpbutton('tablesplit', get_string('configspliton', 'block_dashboard'), 'block_dashboard') ?></b>
        <b><?php print_string('configenablehorizsums', 'block_dashboard'); ?>: <?php helpbutton('configsums', get_string('configenablehorizsums', 'block_dashboard'), 'block_dashboard') ?></b>
        <b><?php print_string('configenablevertsums', 'block_dashboard'); ?>: <?php helpbutton('configsums', get_string('configenablevertsums', 'block_dashboard'), 'block_dashboard') ?></b>
	</td>
	<td>
		<?php
            $verticalkeys = '';
            if (isset($this->config) && isset($this->config->verticalkeys)) {
                $verticalkeys = $this->config->verticalkeys;
            }
            echo '<input type="text" name="verticalkeys" size="20" value="'.$verticalkeys.'" />';
            $horizkey = '';
            if (isset($this->config) && isset($this->config->horizkey)) {
                $horizkey = $this->config->horizkey;
            }
            echo '<br/><input type="text" name="horizkey" size="20" value="'.$horizkey.'" />';
            $verticalformats = '';
            if (isset($this->config) && isset($this->config->verticalformats)) {
                $verticalformats = htmlentities($this->config->verticalformats, ENT_NOQUOTES, 'UTF-8');
            }
            echo '<input type="text" name="verticalformats" size="20" value="'.$verticalformats.'" />';
            $horizformat = '';
            if (isset($this->config) && isset($this->config->horizformat)) {
                $horizformat = htmlentities($this->config->horizformat, ENT_NOQUOTES, 'UTF-8');
            }
            echo '<br/><input type="text" name="horizformat" size="20" value="'.$horizformat.'" />';
            $spliton = '';
            if (isset($this->config) && isset($this->config->spliton)) {
                $spliton = $this->config->spliton;
            }
            echo '<br/><br/><input type="text" name="spliton" size="20" value="'.$spliton.'" />';

            $horizsumsyeschecked = '';
            $horizsumsnochecked = ' checked=\"checked\" ';
            if (isset($this->config) && isset($this->config->horizsums)) {
                $horizsumsyeschecked = ($this->config->horizsums) ? ' checked=\"checked\" ' : '' ;
                $horizsumsnochecked = ($this->config->horizsums) ? ' checked=\"checked\" ' : '' ;
            }
            echo '<br/>';
            echo "<input type=\"radio\" name=\"horizsums\" value=\"0\" $horizsumsnochecked /> ".get_string('no')." - <input type=\"radio\" name=\"horizsums\" value=\"1\" $horizsumsyeschecked /> ".get_string('yes');

            $vertsumsyeschecked = '';
            $vertsumsnochecked = ' checked=\"checked\" ';
            if (isset($this->config) && isset($this->config->vertsums)) {
                $vertsumsyeschecked = ($this->config->vertsums) ? ' checked=\"checked\" ' : '' ;
                $vertsumsnochecked = ($this->config->vertsums) ? ' checked=\"checked\" ' : '' ;
            }
            echo '<br/>';
            echo "<input type=\"radio\" name=\"vertsums\" value=\"0\" $vertsumsnochecked /> ".get_string('no')." - <input type=\"radio\" name=\"vertsums\" value=\"1\" $vertsumsyeschecked /> ".get_string('yes');
        ?>
	</td>
	<td>
        <b><?php print_string('configverticallabels', 'block_dashboard'); ?>:</b><br/>
        <b><?php print_string('confighorizlabel', 'block_dashboard'); ?>:</b><br/>
	</td>
	<td>
		<?php
            $verticallabels = '';
            if (isset($this->config) && isset($this->config->verticallabels)) {
                $verticallabels = htmlentities($this->config->verticallabels, ENT_NOQUOTES, 'UTF-8');
            }
            echo '<input type="text" name="verticallabels" size="30" value="'.$verticallabels.'" />';
            $horizlabel = '';
            if (isset($this->config) && isset($this->config->horizlabel)) {
                $horizlabel = htmlentities($this->config->horizlabel, ENT_NOQUOTES, 'UTF-8');
            }
            echo '<br/><input type="text" name="horizlabel" size="20" value="'.$horizlabel.'" />';
        ?>
	</td>
</tr>
</table>
</fieldset>
</div>

<?php 
$treeviewstyle = (!empty($this->config->tabletype) && $this->config->tabletype == 'treeview') ? 'visibility:visible;display:block' : 'visibility:hidden;display:none' ;
?>
<div id="treeviewparams" style="<?php echo $treeviewstyle ?>">
<fieldset>
<legend><?php print_string('treeviewparams', 'block_dashboard') ?></legend>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
	<td>
        <b><?php print_string('configparent', 'block_dashboard'); ?>: <?php helpbutton('hierarchic', get_string('configparent', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configtreeoutput', 'block_dashboard'); ?>: <?php helpbutton('treeoutput', get_string('configtreeoutput', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configtreeoutputformats', 'block_dashboard'); ?>: <?php helpbutton('formatting', get_string('configtreeoutputformats', 'block_dashboard'), 'block_dashboard') ?></b><br/>
	</td>
	<td>
		<?php
            $parentserie = '';
            if (isset($this->config) && isset($this->config->parentserie)) {
                $parentserie = $this->config->parentserie;
            }
            echo '<input type="text" name="parentserie" size="20" value="'.$parentserie.'" />';
            $treeoutput = '';
            if (isset($this->config) && isset($this->config->treeoutput)) {
                $treeoutput = $this->config->treeoutput;
            }
            echo '<br/><input type="text" name="treeoutput" size="30" value="'.$treeoutput.'" />';
            $treeoutputformats = '';
            if (isset($this->config) && isset($this->config->treeoutputformats)) {
                $treeoutputformats = $this->config->treeoutputformats;
            }
            echo '<br/><input type="text" name="treeoutputformats" size="30" value="'.$treeoutputformats.'" />';
        ?>
	</td>
	<td>
	</td>
	<td>
		<?php
        ?>
	</td>
</tr>
</table>
</fieldset>
</div>

<fieldset>
<legend><?php print_string('graphparams', 'block_dashboard') ?></legend>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
    <td align="center" colspan="4">
        <?php print_string('configreminderonsep', 'block_dashboard'); ?>
    </td>
</tr>
<tr valign="top">
    <td align="right">
        <b><?php print_string('configxaxisfield', 'block_dashboard'); ?>: <?php helpbutton('xaxis', get_string('configxaxisfield', 'block_dashboard'), 'block_dashboard') ?></b>
    </td>
    <td>
        <?php 
            $xaxisfield = '';
            if (isset($this->config) && isset($this->config->xaxisfield)) {
                $xaxisfield = $this->config->xaxisfield;
            }
            echo '<input type="text" name="xaxisfield" size="30" value="'.$xaxisfield.'" />';
        ?>
    </td>
    <td align="right">
        <b><?php print_string('configxaxislabel', 'block_dashboard'); ?>:</b>
    </td>
    <td>
        <?php 
            $xaxislabel = '';
            if (isset($this->config) && isset($this->config->xaxislabel)) {
                $xaxislabel = $this->config->xaxislabel;
            }
            echo '<input type="text" name="xaxislabel" value="'.$xaxislabel.'" />';
        ?>
    </td>
</tr>
<tr valign="top">
    <td align="right" style="line-height:1.5">
        <b><?php print_string('configyseries', 'block_dashboard'); ?>: <?php helpbutton('yseries', get_string('configyseries', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configyseriesformats', 'block_dashboard'); ?>: <?php helpbutton('formatting', get_string('configyseriesformats', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configymin', 'block_dashboard'); ?>: <?php helpbutton('explicitscaling', get_string('confiygmin', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configymax', 'block_dashboard'); ?>:</b><br/>
        <b><?php print_string('configtickspacing', 'block_dashboard'); ?>:</b><br/>
        <b><?php print_string('configyaxisscale', 'block_dashboard'); ?>:</b>
    </td>
    <td style="line-height:1.5">
        <?php 
            $yseries = '';
            if (isset($this->config) && isset($this->config->yseries)) {
                $yseries = $this->config->yseries;
            }
            echo '<input type="text" name="yseries" size="30" value="'.$yseries.'" />';
            $yseriesformats = '';
            if (isset($this->config) && isset($this->config->yseriesformats)) {
                $yseriesformats = htmlentities($this->config->yseriesformats, ENT_NOQUOTES, 'UTF-8');
            }
            echo '<br/><input type="text" name="yseriesformats" size="30" value="'.$yseriesformats.'" />';
            $ymin = '';
            if (isset($this->config) && isset($this->config->ymin)) {
                $ymin = $this->config->ymin;
            }
            echo '<br/><input type="text" name="ymin" size="10" value="'.$ymin.'" />';
            $ymax = '';
            if (isset($this->config) && isset($this->config->ymax)) {
                $ymax = $this->config->ymax;
            }
            echo '<br/><input type="text" name="ymax" size="10" value="'.$ymax.'" />';
            $tickspacing = '';
            if (isset($this->config) && isset($this->config->tickspacing)) {
                $tickspacing = $this->config->tickspacing;
            }
            echo '<br/><input type="text" name="tickspacing" size="10" value="'.$tickspacing.'" />';
            $yaxisscale = '';
            if (isset($this->config) && isset($this->config->yaxisscale)) {
                $yaxisscale = $this->config->yaxisscale;
            }
            $checked1 = ( $yaxisscale == 'linear' ) ? 'checked ="checked"' : '' ;
            $checked2 = ( $yaxisscale == 'log' ) ? 'checked ="checked"' : '' ;
            echo '<br/><input type="radio" name="yaxisscale" value="linear" '.$checked1.' /> '.get_string('linear', 'block_dashboard').' - ';
			echo '<input type="radio" name="yaxisscale" value="log" '.$checked2.' /> '.get_string('log', 'block_dashboard');
        ?>
    </td>
    <td align="right" style="line-height:1.5em">
        <b><?php print_string('configserieslabels', 'block_dashboard'); ?>:</b><br/><br/><br/>
        <b><?php print_string('configyaxislabel', 'block_dashboard'); ?>:</b><br/>
    	<b><?php print_string('configyaxistickangle', 'block_dashboard'); ?>:</b><br/>
    </td>
    <td>
        <?php 
            $serieslabels = '';
            if (isset($this->config) && isset($this->config->serieslabels)) {
                $serieslabels = htmlentities($this->config->serieslabels, ENT_NOQUOTES, 'UTF-8');
            }
            echo '<textarea name="serieslabels" cols="30" rows="4" >'.$serieslabels.'</textarea>';
            $yaxislabel = '';
            if (isset($this->config) && isset($this->config->yaxislabel)) {
                $yaxislabel = $this->config->yaxislabel;
            }
            echo '<br/><input type="text" name="yaxislabel" size="30" value="'.$yaxislabel.'" />';
            $yaxistickangle = '';
            if (isset($this->config) && isset($this->config->yaxistickangle)) {
                $yaxistickangle = $this->config->yaxistickangle;
            }
            $checked1 = ( $yaxistickangle == '-45' ) ? 'checked ="checked"' : '' ;
            $checked2 = ( $yaxistickangle == '0' ) ? 'checked ="checked"' : '' ;
            $checked3 = ( $yaxistickangle == '45' ) ? 'checked ="checked"' : '' ;
            $checked4 = ( $yaxistickangle == '90' ) ? 'checked ="checked"' : '' ;
            echo '<br/><input type="radio" name="yaxistickangle" value="-45" '.$checked1.' /> -45 - ';
			echo '<input type="radio" name="yaxistickangle" value="0" '.$checked2.' /> 0 - ';
            echo '<input type="radio" name="yaxistickangle" value="45" '.$checked3.' /> 45 - ';
            echo '<input type="radio" name="yaxistickangle" value="90" '.$checked4.' /> 90 ';
        ?>
    </td>
</tr>
<tr valign="top">
    <td align="right" style="line-height:1.5em">
        <b><?php print_string('configgraphtype', 'block_dashboard'); ?>:</b><br/>
    	<b><?php print_string('configgraphwidth', 'block_dashboard'); ?>:</b><br/>
        <b><?php print_string('configgraphheight', 'block_dashboard'); ?>:</b>
    </td>
    <td>
        <?php 
            $graphtypes = array(
            	'line' => get_string('line', 'block_dashboard'), 
            	'bar' => get_string('bar', 'block_dashboard'), 
            	'pie' => get_string('pie', 'block_dashboard'), 
            	'donut' => get_string('donut', 'block_dashboard'),
            	'timegraph' => get_string('timegraph', 'block_dashboard'),
            	'timeline' => get_string('timeline', 'block_dashboard'),
            	'googlemap' => get_string('googlemap', 'block_dashboard'),
            );
            $graphtype = 0;
            if (isset($this->config) && isset($this->config->graphtype)) {
                $graphtype = $this->config->graphtype;
            }
            choose_from_menu($graphtypes, 'graphtype', $graphtype, '', 'showmoreoptions(this);');
            $graphwidth = 450;
            if (isset($this->config) && isset($this->config->graphwidth)) {
                $graphwidth = $this->config->graphwidth;
            }
            $graphheight = 250;
            if (isset($this->config) && isset($this->config->graphheight)) {
                $graphheight = $this->config->graphheight;
            }
        ?>
        <br/><input type="text" name="graphwidth" value="<?php echo $graphwidth ?>" /><br/>
        <input type="text" name="graphheight" value="<?php echo $graphheight ?>" />
    </td>
    <td align="right">
        <b><?php print_string('configshowlegend', 'block_dashboard'); ?>:</b>
    </td>
    <td>
	    <?php print_string('configshowlegend', 'block_dashboard'); ?>
	    <input type="radio" name="showlegend" value="1" <?php echo (@$this->config->showlegend) ? 'checked="checked"' : '' ?> />
	    <?php print_string('yes'); ?>
	    <input type="radio" name="showlegend" value="0" <?php echo (!@$this->config->showlegend) ? 'checked="checked"' : '' ?> />
	    <?php print_string('no'); ?>
	    <?php echo '<br/>' ?>
	</td>
</tr>
</table>
</fieldset>

<?php 
$googlemapstyle = (!empty($this->config->graphtype) && $this->config->graphtype == 'googlemap') ? 'visibility:visible;display:block' : 'visibility:hidden;display:none' ;
?>
<div id="googlemapparams" style="<?php echo $googlemapstyle ?>">
<fieldset>
<legend><?php print_string('googleparams', 'block_dashboard') ?></legend>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
    <td align="right" style="line_height:1.5em">
        <b><?php print_string('configmaptype', 'block_dashboard'); ?>: <?php helpbutton('maptype', get_string('configmaptype', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configzoom', 'block_dashboard'); ?>: <?php helpbutton('zoom', get_string('configzoom', 'block_dashboard'), 'block_dashboard') ?></b><br/><br/><br/>
        <b><?php print_string('configdata', 'block_dashboard'); ?>: <?php helpbutton('gmdata', get_string('configdata', 'block_dashboard'), 'block_dashboard') ?></b>
    </td>
    <td>
        <?php 
        	$maptypeopts = array(
        		'ROADMAP' => get_string('maptyperoadmap', 'block_dashboard'),
        		'SATELLITE' => get_string('maptypesatellite', 'block_dashboard'),
        		'HYBRID' => get_string('maptypehybrid', 'block_dashboard'),
        		'TERRAIN' => get_string('maptypeterrain', 'block_dashboard'),
        	);
            $maptype = 'ROADMAP';
            if (isset($this->config) && isset($this->config->maptype)) {
                $maptype = $this->config->maptype;
            }
            choose_from_menu($maptypeopts, 'maptype', $maptype);
            $zoom = '6';
            if (isset($this->config) && isset($this->config->zoom)) {
                $zoom = $this->config->zoom;
            }
            echo '<br/><input type="text" name="zoom" size="30" value="'.$zoom.'" />';

            $datatitles = '';
            if (isset($this->config) && isset($this->config->datatitles)) {
                $datatitles = $this->config->datatitles;
            }
            $datalocations = '';
            if (isset($this->config) && isset($this->config->datalocations)) {
                $datalocations = $this->config->datalocations;
            }
            $datatypes = '';
            if (isset($this->config) && isset($this->config->datatypes)) {
                $datatypes = $this->config->datatypes;
            }
            echo '<br/><br/><table cellpadding="2"><tr><td>'.get_string('datatitles', 'block_dashboard').'</td><td>'.get_string('datalocations', 'block_dashboard').'</td><td>'.get_string('datatypes', 'block_dashboard').'</td></tr>';
            echo '<tr><td><input type="text" name="datatitles" size="12" value="'.$datatitles.'" /></td>';
            echo '<td><input type="text" name="datalocations" size="35" value="'.$datalocations.'" /></td>';
            echo '<td><input type="text" name="datatypes" size="12" value="'.$datatypes.'" /></td></tr></table>';
        ?>
    </td>
    <td align="right" style="line_height:1.5em">
        <b><?php print_string('configlocation', 'block_dashboard'); ?>:</b><br/>
    </td>
    <td>
        <?php 
            $lat = '0';
            $lng = '0';
            if (isset($this->config) && isset($this->config->lat)) {
                $lat = $this->config->lat;
            }
            if (isset($this->config) && isset($this->config->lng)) {
                $lng = $this->config->lng;
            }
            echo '(lat : <input type="text" size="8" name="lat" value="'.$lat.'" />, long : <input type="text"  size="8" name="lng" value="'.$lng.'" />)';
        ?>
    </td>
</tr>
</table>
</fieldset>
</div>

<?php 
$timelinestyle = (!empty($this->config->graphtype) && $this->config->graphtype == 'timeline') ? 'visibility:visible;display:block' : 'visibility:hidden;display:none' ;
?>
<div id="timelineparams" style="<?php echo $timelinestyle ?>">
<fieldset>
<legend><?php print_string('timelineparams', 'block_dashboard') ?></legend>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
    <td align="right" style="line-height:1.5em">
        <b><?php print_string('configshowlowerband', 'block_dashboard'); ?>: <?php helpbutton('bands', get_string('configshowlowerband', 'block_dashboard'), 'block_dashboard') ?></b><br/>
    </td>
    <td style="line-height:1.5em">
    <?php
    	$showlowerbandyes = 'checked="checked"';
    	$showlowerbandno = '';
        if (isset($this->config) && isset($this->config->showlowerband)) {
            $showlowerbandyes = ($this->config->showlowerband) ? ' checked="checked" ' : '' ;
            $showlowerbandno = (!$this->config->showlowerband) ? ' checked="checked" ' : '' ;
        }
    ?>
    	<input type="radio" name="showlowerband" value="1" <?php echo $showlowerbandyes ?> > <?php print_string('yes') ?> - <input type="radio" name="showlowerband" value="0" <?php echo $showlowerbandno ?> > <?php print_string('no') ?>
    </td>
    <td align="right" style="line-height:1.8em">
        <b><?php print_string('configupperbandunit', 'block_dashboard'); ?>: <?php helpbutton('timeunits', get_string('configupperbandunit', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configlowerbandunit', 'block_dashboard'); ?>: <?php helpbutton('timeunits', get_string('configlowerbandunit', 'block_dashboard'), 'block_dashboard') ?></b>
    </td>
    <td style="line-height:1.5em">
	<?php
    	$upperbandunit = 'MONTH';
        if (isset($this->config) && isset($this->config->upperbandunit)) {
            $upperbandunit = $this->config->upperbandunit;
        }
        $upperunits = array('MONTH' => get_string('month', 'block_dashboard'),
        	'WEEK' => get_string('week', 'block_dashboard'),
        	'DAY' => get_string('day', 'block_dashboard'),
        	'HOUR' => get_string('hour', 'block_dashboard'));
		choose_from_menu($upperunits, 'upperbandunit', $upperbandunit);

    	$lowerbandunit = 'YEAR';
        if (isset($this->config) && isset($this->config->lowerbandunit)) {
            $lowerbandunit = $this->config->lowerbandunit;
        }
        $lowerunits = array('YEAR' => get_string('year', 'block_dashboard'),
        	'MONTH' => get_string('month', 'block_dashboard'),
        	'WEEK' => get_string('week', 'block_dashboard'),
        	'DAY' => get_string('day', 'block_dashboard'));
		echo '<br/>';
		choose_from_menu($lowerunits, 'lowerbandunit', $lowerbandunit);
	?>
    </td>
</tr>
<tr valign="top">
    <td align="right" style="line-height:1.5em">
        <b><?php print_string('configeventmapping', 'block_dashboard'); ?>: <?php helpbutton('eventmapping', get_string('configeventmapping', 'block_dashboard'), 'block_dashboard') ?></b><br/>
    </td>
    <td colspan="3" style="line-height:1.5em">
        <?php 
        	$eventtitle = '';
            if (isset($this->config) && isset($this->config->timelineeventtitle)) {
                $eventtitle = $this->config->timelineeventtitle;
            }

        	$eventstart = '';
            if (isset($this->config) && isset($this->config->timelineeventstart)) {
                $eventstart = $this->config->timelineeventstart;
            }

        	$eventend = '';
            if (isset($this->config) && isset($this->config->timelineeventend)) {
                $eventend = $this->config->timelineeventend;
            }

        	$eventlink = '';
            if (isset($this->config) && isset($this->config->timelineeventlink)) {
                $eventlink = $this->config->timelineeventlink;
            }

        	$eventdesc = '';
            if (isset($this->config) && isset($this->config->timelineeventdesc)) {
                $eventdesc = $this->config->timelineeventdesc;
            }

            echo '<br/><br/><table cellpadding="2"><tr>';
            echo '<td>'.get_string('eventtitles', 'block_dashboard').'</td>';
            echo '<td>'.get_string('eventstart', 'block_dashboard').'</td>';
            echo '<td>'.get_string('eventend', 'block_dashboard').'</td>';
            echo '<td>'.get_string('eventlink', 'block_dashboard').'</td>';
            echo '<td>'.get_string('eventdesc', 'block_dashboard').'</td>';
            echo '</tr>';
            echo '<tr><td><input type="text" name="timelineeventtitle" size="12" value="'.$eventtitle.'" /></td>';
            echo '<td><input type="text" name="timelineeventstart" size="12" value="'.$eventstart.'" /></td>';
            echo '<td><input type="text" name="timelineeventend" size="12" value="'.$eventend.'" /></td>';
            echo '<td><input type="text" name="timelineeventlink" size="12" value="'.$eventlink.'" /></td>';
            echo '<td><input type="text" name="timelineeventdesc" size="12" value="'.$eventdesc.'" /></td>';
            echo '</tr></table>';
        ?>
    </td>
</tr>
<tr valign="top">
    <td align="center">
        <?php print_string('configcolors', 'block_dashboard'); ?>
        <br/><textarea cols="20" rows="10" name="timelinecolors" ><?php echo @$this->config->timelinecolors ?></textarea>
    </td>
    <td align="center">
        <b><?php print_string('configcolorfield', 'block_dashboard'); ?>:</b>
        <br/><input type="text" name="timelinecolorfield" value="<?php echo @$this->config->timelinecolorfield ?>" size="20" />
    </td>
    <td align="center">
        <?php print_string('configcoloredvalues', 'block_dashboard'); ?>
        <br/><textarea cols="20" rows="10" name="timelinecolorkeys" ><?php echo @$this->config->timelinecolorkeys ?></textarea>
    </td>
</tr>
</table>
</fieldset>
</div>

<fieldset>
<legend><?php print_string('summatorsparams', 'block_dashboard') ?></legend>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
    <td align="center" colspan="4">
        <?php print_string('configreminderonsep', 'block_dashboard'); ?>
    </td>
</tr>
<tr valign="top">
    <td align="right" style="line-height:1.5em">
        <b><?php print_string('confignumsums', 'block_dashboard'); ?>: <?php helpbutton('summators', get_string('confignumsums', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('confignumsumsformats', 'block_dashboard'); ?>: <?php helpbutton('formatting', get_string('configoutputfields', 'block_dashboard'), 'block_dashboard') ?></b>
    </td>
    <td>
        <?php 
            $numsums = '';
            if (isset($this->config) && isset($this->config->numsums)) {
                $numsums = $this->config->numsums;
            }
            echo '<input type="text" name="numsums" size="30" value="'.$numsums.'" />';
            $numsumformats = '';
            if (isset($this->config) && isset($this->config->numsumformats)) {
                $numsumformats = htmlentities($this->config->numsumformats, ENT_NOQUOTES, 'UTF-8');
            }
            echo '<br/><input type="text" name="numsumformats" size="30" value="'.$numsumformats.'" />';
        ?>
    </td>
    <td align="right">
        <b><?php print_string('confignumsumslabels', 'block_dashboard'); ?>:</b>
    </td>
    <td>
        <?php 
            $numsumlabels = '';
            if (isset($this->config) && isset($this->config->numsumlabels)) {
                $numsumlabels = $this->config->numsumlabels;
            }
            echo '<textarea name="numsumlabels" cols="30" rows="5" >'.$numsumlabels.'</textarea>';
        ?>
    </td>
</tr>
</table>
</fieldset>

<fieldset>
<legend><?php print_string('tablecolormapping', 'block_dashboard') ?></legend>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
    <td align="center">
        <?php print_string('configcolors', 'block_dashboard'); ?>
        <br/><textarea cols="20" rows="10" name="colors" ><?php echo @$this->config->colors ?></textarea>
    </td>
    <td align="center">
        <b><?php print_string('configcolorfield', 'block_dashboard'); ?>:</b>
        <br/><input type="text" name="colorfield" value="<?php echo @$this->config->colorfield ?>" size="20" />
    </td>
    <td align="center">
        <?php print_string('configcoloredvalues', 'block_dashboard'); ?>
        <br/><textarea cols="20" rows="10" name="coloredvalues" ><?php echo @$this->config->coloredvalues ?></textarea>
    </td>
</tr>
</table>
</fieldset>

<fieldset>
<legend><?php print_string('datarefresh', 'block_dashboard') ?></legend>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
    <td align="right" style="line-height:1.5em">
        <b><?php print_string('configcronmode', 'block_dashboard'); ?>: <?php helpbutton('delayedefresh', get_string('configcronmode', 'block_dashboard'), 'block_dashboard') ?></b><br/>
    </td>
    <td>
        <?php 
            $cronmode = '';
            if (isset($this->config) && isset($this->config->cronmode)) {
                $cronmode = $this->config->cronmode;
            } else {
            	$cronmode = 'norefresh';
            }
            
            $modes['norefresh'] = get_string('norefresh', 'block_dashboard');
            $modes['global'] = get_string('globalcron', 'block_dashboard');
            $modes['instance'] = get_string('instancecron', 'block_dashboard');
            choose_from_menu($modes, 'cronmode', $cronmode);
        ?>
    </td>
    <td align="right" style="line-height:1.5em">
        <b><?php print_string('configcrontime', 'block_dashboard'); ?>: </b><br/>
        <b><?php print_string('configcronfrequency', 'block_dashboard'); ?>: </b>
    </td>
    <td>
        <?php 
            $cronhour = '';
            if (isset($this->config) && isset($this->config->cronhour)) {
                $cronhour = $this->config->cronhour;
            }
            $cronmin = '';
            if (isset($this->config) && isset($this->config->cronmin)) {
                $cronmin = $this->config->cronmin;
            }
            for($i = 0; $i < 24; $i++){
	            $hours["$i"] = sprintf('%02d', $i);
	        }
			$mins['00'] = '00';
			$mins['15'] = '15';
			$mins['30'] = '30';
			$mins['45'] = '45';
            choose_from_menu($hours, 'cronhour', $cronhour);
            print_string('hours', 'block_dashboard');
            echo ' ';
            choose_from_menu($mins, 'cronmin', $cronmin);
            print_string('mins', 'block_dashboard');
            
            $cronfrequency = '';
            if (isset($this->config) && isset($this->config->cronfrequency)) {
                $cronfrequency = $this->config->cronfrequency;
            } else {
            	$cronfrequency = 'daily';
            }

			$freq['daily'] = get_string('daily', 'block_dashboard');
			$freq['0'] = get_string('sunday', 'block_dashboard');
			$freq['1'] = get_string('monday', 'block_dashboard');
			$freq['2'] = get_string('tuesday', 'block_dashboard');
			$freq['3'] = get_string('wednesday', 'block_dashboard');
			$freq['4'] = get_string('thursday', 'block_dashboard');
			$freq['5'] = get_string('friday', 'block_dashboard');
			$freq['6'] = get_string('saturday', 'block_dashboard');
			echo '<br/>';
            choose_from_menu($freq, 'cronfrequency', $cronfrequency, '');
        ?>
    </td>
</tr>
</table>
</fieldset>

<fieldset>
<legend><?php print_string('fileoutput', 'block_dashboard') ?></legend>
<table width="100%" cellpadding="5" cellspacing="0">
<tr valign="top">
    <td align="right" style="line-height:1.5">
        <b><?php print_string('configmakefile', 'block_dashboard'); ?>: <?php helpbutton('delayedefresh', get_string('configcronmode', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configfileoutput', 'block_dashboard'); ?>: <?php helpbutton('fileoutput', get_string('configfileoutput', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configfileoutputformats', 'block_dashboard'); ?>: <?php helpbutton('formatting', get_string('configfileoutputformats', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configfileformat', 'block_dashboard'); ?>: <?php helpbutton('fileoutput', get_string('configfileformat', 'block_dashboard'), 'block_dashboard') ?></b><br/>
        <b><?php print_string('configfilesqlouttable', 'block_dashboard'); ?>: <?php helpbutton('filesqlouttable', get_string('configfilesqlouttable', 'block_dashboard'), 'block_dashboard') ?></b><br/>
    </td>
    <td style="line-height:1.5">
        <?php 
            $makefile = '';
            if (isset($this->config) && isset($this->config->makefile)) {
                $makefile = $this->config->makefile;
            } else {
            	$this->config->makefile = 0;
            }
            $checked1 = ( $makefile == 0 ) ? 'checked ="checked"' : '' ;
            $checked2 = ( $makefile == 1 ) ? 'checked ="checked"' : '' ;
            echo '<input type="radio" name="makefile" value="0" '.$checked1.' /> '.get_string('no');
			echo ' - <input type="radio" name="makefile" value="1" '.$checked2.' />  '.get_string('yes');

            $fileoutput = '';
            if (isset($this->config) && isset($this->config->fileoutput)) {
                $fileoutput = $this->config->fileoutput;
            }
            echo '<br/><input type="text" name="fileoutput" value="'.$fileoutput.'" />';

            $fileoutputformats = '';
            if (isset($this->config) && isset($this->config->fileoutputformats)) {
                $fileoutputformats = $this->config->fileoutputformats;
            }
            echo '<br/><input type="text" name="fileoutputformats" value="'.$fileoutputformats.'" />';

            $fileformat = 'CSV';
            if (isset($this->config) && isset($this->config->fileformat)) {
                $fileformat = $this->config->fileformat;
            }
            $fileformats = array(
            	'CSV' => get_string('csv', 'block_dashboard'),
            	'CSVWH' => get_string('csvwithoutheader', 'block_dashboard'),
            	'SQL' => get_string('sqlinserts', 'block_dashboard'));
            echo '<br/>';
            choose_from_menu($fileformats, 'fileformat', $fileformat);

            $filesqlouttable = '';
            if (isset($this->config) && isset($this->config->filesqlouttable)) {
                $filesqlouttable = $this->config->filesqlouttable;
            }
            echo '<br/><input type="text" name="filesqlouttable" value="'.$filesqlouttable.'" />';
        ?>
    </td>
    <td align="right">
        <b><?php print_string('configfilelocation', 'block_dashboard'); ?>: <?php helpbutton('filelocation', get_string('configfilelocation', 'block_dashboard'), 'block_dashboard') ?></b><br/>
		<?php
		if (has_capability('moodle/site:doanything', get_context_instance(CONTEXT_SYSTEM))){
        	echo '<b>';
        	print_string('configfilepathadminoverride', 'block_dashboard'); 
        	echo ' : ';
        	helpbutton('filelocationadmin', get_string('configfilepathadminoverride', 'block_dashboard'), 'block_dashboard');
        	echo '</b>';
        }
		?>
    </td>
    <td>
        <?php 
            $filelocation = '';
            if (isset($this->config) && isset($this->config->filelocation)) {
                $filelocation = $this->config->filelocation;
            }
            echo '<input type="text" name="filelocation" size="30" value="'.$filelocation.'" />';
            $filepathadminoverride = '';
            if (isset($this->config) && isset($this->config->filepathadminoverride)) {
                $filepathadminoverride = $this->config->filepathadminoverride;
            }
            echo '<br/><input type="text" name="filepathadminoverride" size="30" value="'.$filepathadminoverride.'" />';
        ?>
    </td>
</tr>
</table>
</fieldset>

<?php global $COURSE ?>
<table width="100%" cellpadding="5" cellspacing="0">
<tr>
    <td colspan="3" align="center">
      <a href="<?php echo $CFG->wwwroot."/blocks/dashboard/copyconfig.php?id={$COURSE->id}&amp;instance={$this->instance->id}" ?>&amp;what=upload"><?php print_string('importconfig', 'block_dashboard') ?></a> - 
      <a href="<?php echo $CFG->wwwroot."/blocks/dashboard/copyconfig.php?id={$COURSE->id}&amp;instance={$this->instance->id}" ?>&amp;what=get" target="_blank"><?php print_string('exportconfig', 'block_dashboard') ?></a> - 
      <input type="submit" value="<?php print_string("savechanges") ?>" />
    </td>
</tr>
</table>